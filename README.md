Author: Suyash Shringarpure

This is a modified version of the code used for ancestry inference in Pan-Cancer Analysis of Whole Genomes project (https://www.nature.com/articles/s41586-020-1969-6). The exact version of the code used in the paper is available at the Sage Bionetworks Synapse platform under syn4877977.

It can be used to infer continental ancestry for a multiple individuals from a VCF using an ADMIXTURE-like likelihood model. The ancestry informative markers (AIMs) used for this analysis were generated by Genevieve Wojcik and Christopher Gignoux for the MEGA chip.

The files included are:
* aims.bed and aims.hg19.bed : List of aims as a bed file. These can be used to filter a VCF to only the AIM sites to reduce file size and make reading efficient. The aims.bed assumes the b37 format (Eg: "22 100054 100055") whereas the aims.hg19.bed assumes the Hg19 format (Eg "chr22 100054 100055"). Use either one depending on the reference genome used to create the vcf.

* freqs.txt and freqs.hg19.txt : AIM frequencies for the 5 continents (AFR = Africa; ASN = East Asia ; AMR = Americas ; SAN = South Asian ; EUR = European). The freqs.txt has b37 format for genome positions and freqs.hg19.txt has the Hg19 format.

* infer_ancestry_from_vcf.r:  The R file that does all the work. You will need the "plyr" package and the "nloptr" package installed along with R. The script currently outputs proportion of ancestry from each continental population, one line per sample, to the standard output.

The infer_ancestry_from_vcf.r script takes in two arguments :
* A file with AIM frequencies for populations (freqs.txt or freqs.hg19.txt) .
* A vcf file, which has only SNPs, has sites filtered only to the AIM locations provided  and assumes that the first field present in the format is "GT" or the genotype. The vcf file is not gzipped. I used vcftools to do this with the command - vcftools --gzvcf <infile.vcf.gz> --bed aims.bed --out <outfile> --recode --remove-indels --min-alleles 2 --max-alleles 2 --remove-filtered-all

Run this as: Rscript infer_ancestry_from_vcf.r \<frequencyfile\> \<vcffile\>


